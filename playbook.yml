---
- hosts: bastion
  become: true

  vars_files:
    - default.config.yml

  pre_tasks:

    - name: Add apt-key for Helm
      apt_key:
        url: "{{ helm_apt_key_url }}"

    - name: Add repo for Helm
      apt_repository:
        repo: "{{ helm_repo }}"
        state: present
        filename: helm-stable-debian

    - name: Update apt cache
      apt:
        update_cache: yes

  tasks:

    - name: Include grog.package
      include_role:
        name: grog.package
      vars:
        package_list:
          - name: dhcping
          - name: git
          - name: helm
          - name: htop
          - name: nano
          - name: net-tools
          - name: vim
          - name: wget

    - name: Download oc client
      get_url: 
        url: "{{ oc_binary_url }}"
        dest: /tmp/oc.tar.gz
        mode: '0777'

    - name: Extract oc client
      unarchive:
        src: /tmp/oc.tar.gz
        dest: /tmp/

    - name: Copy oc binary to /usr/local/bin
      copy:
        src: /tmp/oc
        dest: /usr/local/bin/oc
        mode: "0777"
        remote_src: yes

 # add users
 # add ssh keys from github
 
    - name: Include grog.sudo
      include_role:
        name: grog.sudo
      vars:
        sudo_list:
          - name: ckaserer
            sudo:
              hosts: ALL
              as: ALL:ALL
              nopasswd: yes
              commands: ALL

    - name: Include ckaserer.gitlab_runner
      include_role:
        name: ckaserer.gitlab_runner
      vars:
        arch: "amd64"
...
